# chpater18. 함수형 관점으로 생각하기

---

**chapter18의 핵심** ✨

함수형 프로그래밍이 무엇인지 알아보고 어떤 특징이 있는지 알아보자!

---

사실 함수형 프로그래밍이란 말은 계속해서 언급해 왔던 프로그래밍 기법이다.

(당연함. 자바8의 핵심이 함수형 프로그래밍임. 🤭)

따라서 이번 장은 정리 및 복습한다는 의미로 가볍게 들어도 된다. 😉

<br>

## 시스템 구현과 유지보수

+ 결합성 : 시스템 각 부분의 상호 의존성

+ 응집성 : 시스템의 다양한 부분이 서로 어떤 관계를 갖는지 가리킴

<br>

개발자의 유지보수를 어렵게 하는 문제들 중엔 코드 크래시 디버깅 문제가 있다. 특히 예상하지 못한 변수 값 때문에 크래시 현상이 발생할 수 있는데 함수형 프로그래밍이 이 문제를 해결하는 데 도움을 준다. 

왜냐면... 함수형 프로그래밍은 **부작용이 없고, 불변성**이라는 개념이 있기 때문이다! 🙌

<br>

### 공유된 가변 데이터

어떤 리스트가 있는데 이 리스트는 다양한 클래스에서 사용하고 있으며 심지어 갱신 작업까지 이루어진다. 이렇게 공유 가변 데이터 구조를 사용하면 프로그램 전체에서 데이터 갱신 사실을 추적하기가 어렵다. 한마디로 유지보수가 힘들다.

자신을 포함하는 클래스의 상태와 다른 객체의 상태를 바꾸지 않고 return 문으로 자신의 결과를 반환하면 어떨까? 생각만 해도 유지보수할 때 행복할 것 같다... 😊 ~~사실 행복하진 않음~~

위와 같은 메서드를 **순수 메서드** 또는 **부작용 없는** 메서드라고 부른다.

부작용이 뭘까...? 번역체 특유의 무슨 말인지 알겠는데 뭔 말인지 모르겠다면 다음 예를 보자.

+ 자료구조를 고치거나 필드에 값을 할당

+ 예외 발생

+ 파일에 쓰기 등의 I/O 동작 수행

<br>

불변 객체를 이용해서 위의 부작용을 없애는 방법이 있다. 말 그대로 '불변'이기 때문에 갱신 작업에 영향을 받지 않는다. 따라서, 복사 없이 공유가 가능하며 스레드 안정성을 제공한다.

<br>

### 선언형 프로그래밍

함수형 프로그래밍의 기반을 이루는 프로그래밍 기법으로 이전에 내부 반복 프로그래밍 등으로 이미 본 사이이다. 😏

선언형 프로그래밍은 '무엇에' 집중하는 방식이다. 이전의 객체 지향 방식은 '어떻게'에 집중했다는 걸 보면 스펙트럼의 양끝에 위치하는 기법들이라고 생각하면 쉽다.

<br>

## 함수형 프로그래밍이란 무엇인가?

<img src="https://user-images.githubusercontent.com/62419307/212107948-7f3228f2-40df-4f24-992c-606431eca491.png" title="" alt="image" width="212">

함수형 프로그래밍이란 무엇인가... 함수형 프로그래밍은 함수를 이용하는 프로그래밍이다. (끄덕) 

그러면 함수란 무엇일까? 0개 이상의 인수를 가지며, 한 개 이상의 결과를 반환하는 친구다. 이때 **부작용은 없어야 한다.** 즉, 함수형은 '부작용이 없는' 프로그래밍 기법을 말한다.

<br>

#### 다른 부분에 영향을 미치지 않는다면 함수형 프로그래밍인가요? 🙋‍♀️

넵 그렇습니다. 즉, 내부적으로는 부작용이 발생하지만 호출자가 이를 알아차리지 못하면 실제로 부작용이 발생한 것이라고 볼 수 없다. 

그러니까 내부에서 갱신 작업이 일어난다고 해도 인수로 받은 자료구조에 직접적으로 변조를 한 게 아니고 인수를 복제한 변수에 갱신 작업을 한다면 호출자에겐 영향을 미치지 않기 때문에 함수형 프로그래밍이라고 할 수 있다는 것이다. 🤯

결론적으로 함수나 if-then-else 등의 수학적 표현만 사용하는 방식을 **순수 함수형 프로그래밍**이라고 하며, 시스템의 다른 부분에 영향을 미치지 않는다면 내부적으로는 함수형이 아닌 기능도 사용하는 방식을 **함수형 프로그래밍**이라고 한다.

<br>

### 함수형 자바

**함수형 프로그래밍의 조건**

+ 함수나 메서드는 지역 변수만을 변경해야 함

+ 함수나 메서드에서 참조하는 객체가 있다면 그 객체는 불변객체여야 함
  즉, 객체의 모든 필드가 final이어야 하고 참조 필드는 불변 객체를 직접 참조해야 함

+ 함수나 메서드가 어떤 예외도 일으키지 않아야 한다.
  → 예외를 일으키지 않고 표현하기 위해 Optional을 활용할 수 있다.

+ 비함수형 동작을 감출 수 있는 상황에서만 부작용을 포함하는 라이브러리 함수를 사용해야 함 (자료구조의 변경을 호출자가 알 수 없도록 감춰야 함)
  
  <br>

### 참조 투명성

함수형 프로그래밍에서 나온 '부작용을 감춰야 한다'라는 제약이 바로 '참조 투명성' 개념으로 이어진다. 즉, 같은 인수로 함수를 호출했을 때 결과값이 똑같아야 한다.

ex) Random.nextInt는 매번 랜덤 값을 출력하므로 참조 투명성을 위배한다고 볼 수 있다.

<br>

### 재귀와 반복

호출자만 알지 못한다면 내부적으로 갱신 작업 등의 부작용이 발생해도 된다고 했지만 순수 함수형 씨는 그것도 용납하지 못하겠다고 합니다...

그렇게 되면 while 같은 반복문은 순수 함수형 프로그래밍 기법에 들어갈 수 없다. 😯

이 경우, 재귀를 사용하면 된다! 다만, 재귀의 경우 일반 반복문보단 비용이 비싸기 때문에 주의해야 한다.

반복을 스트림으로 대체해서 변화를 피할 수 있고, 위 내용처럼 반복을 재귀로 바꿔서 부작용이 없는 알고리즘을 만들 수도 있다.

<br>

## 정리

1. 함수형 프로그래밍은 부작용이 없는 메서드와 선언형 프로그래밍 방식을 지향한다.

2. 같은 인수값으로 함수를 호출했을 때 항상 같은 값을 반환하면 참조 투명성을 갖는 함수라고 할 수 있다.

3. while 루프 같은 반복문은 재귀로 대체할 수 있다.
